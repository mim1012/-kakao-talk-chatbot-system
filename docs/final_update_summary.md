# 카카오톡 OCR 챗봇 시스템 - 최종 업데이트 요약

최종 업데이트일: 2025-08-05

## 주요 개선사항

### 1. 마우스 자동화 안정성 개선
- **문제**: Win32 API의 SendInput이 듀얼 모니터 환경에서 정확한 좌표로 이동하지 못함
- **해결**: PyAutoGUI를 기본으로 사용하도록 변경
- **구현 위치**: `src/gui/chatbot_gui.py` (라인 628-650)

### 2. 화면 깜빡임 제거
- **문제**: OCR 감지 시 오버레이의 초록색/빨간색 표시로 인한 화면 깜빡임이 클릭을 방해
- **해결**:
  - 오버레이 색상 표시 비활성화 (라인 750-754)
  - 디버그 스크린샷 저장 비활성화 (라인 624-626, 387-392)
  - 감지 후 즉시 클릭하도록 대기 시간 제거

### 3. 클릭 위치 정확도 개선
- **설정**: `config.json`의 `input_box_offset`을 20px로 설정
- **효과**: 각 셀의 하단에서 20px 위를 클릭하여 카카오톡 입력창 정확히 타겟팅

### 4. 오버레이 높이 조정 기능
- **기능**: GUI에서 실시간으로 OCR 영역 높이를 10px 단위로 조정 가능
- **범위**: 30px ~ 200px
- **위치**: 고급 설정 탭의 슬라이더

## 현재 동작 흐름

1. **OCR 감지**
   - PaddleOCR이 각 셀의 OCR 영역에서 텍스트 감지
   - 트리거 패턴 매칭 ("들어왔습니다" 등)

2. **자동화 실행**
   ```
   감지 → 즉시 마우스 이동 (0.1초) → 클릭 → 더블클릭 → 텍스트 붙여넣기 → Enter
   ```

3. **성능 특징**
   - 화면 깜빡임 없음
   - 감지 후 1초 이내 응답
   - 포커스 유지

## 주요 설정 파일

### config.json
```json
{
  "ocr_interval_sec": 0.3,       // OCR 스캔 주기
  "input_box_offset": {
    "from_bottom": 20,           // 셀 하단에서 클릭 위치 (px)
  },
  "trigger_patterns": ["들어왔습니다", "님이", "입장", "들어왔", "참여"]
}
```

### 자동화 디버그 로그
- 위치: `automation_debug.log`
- 내용: 클릭 좌표, 시간, 성공 여부 기록

## 문제 해결 가이드

### 클릭이 안 될 때
1. 카카오톡 창이 최상위에 있는지 확인
2. `input_box_offset` 값 조정 (기본 20px)
3. 오버레이가 켜져 있다면 끄기

### OCR이 텍스트를 못 찾을 때
1. 오버레이 높이 조정 (GUI의 슬라이더 사용)
2. 카카오톡 창이 OCR 영역에 정확히 위치했는지 확인

### 성능 최적화
1. `ocr_interval_sec` 증가시 CPU 사용량 감소
2. 불필요한 셀은 비활성화

## 테스트 확인 사항
- [x] 마우스가 정확한 위치로 이동
- [x] 클릭이 정상 작동
- [x] 텍스트 입력 및 전송 성공
- [x] 화면 깜빡임 없음
- [x] 5초 쿨다운 정상 작동